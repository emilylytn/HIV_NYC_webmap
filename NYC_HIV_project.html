<html> 
  <head>
    <title>HIV Leaflet Map</title> 
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
   integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
   crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
   integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
   crossorigin=""></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"> </script>
    <script src='https://code.jquery.com/jquery-1.11.0.min.js'></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <link href="https://fonts.googleapis.com/css?family=Quicksand:300,500" rel="stylesheet">

    <style>
    .info { padding: 6px 8px; font: 14px/16px 'Quicksand', sans-serif; background: white; background: rgba(255,255,255,0.8); box-shadow: 0 0 15px rgba(0,0,0,0.2); border-radius: 5px; } 
    .info h4 { margin: 0 0 5px; color: 777; }
    .legend { text-align: left; line-height: 18px; color: 555; } 
    .legend i { width: 18px; height: 18px; float: left; margin-right: 8px; opacity: 0.7; }
    </style>


  </head>

  <body style="background-color:#F6FFFF">
    <h1 style="font-family:'Quicksand', sans-serif; text-align:center;"><b>Visualizing Social Determinants of HIV Across NYC Zipcodes</b> </h1>
    <h4 style="font-family:'Quicksand', sans-serif; text-align:center;">Made by Emily Luy Tan</h4>
    <h6 style="font-family:'Quicksand', sans-serif; text-align:center;">GEOG 50.02, Spring 2020</h6>

    <div class="container">
      <div class="btn-group" style="font-family:'Quicksand', sans-serif; width:100%">
        <!-- Trigger the modal with a button -->

        <button style="font-family:'Quicksand', sans-serif; width: 200px;
          position:relative; left: 25%;
          padding: 10px;
          background-color: #FFF48F;
          color: #35362C;
          border: 1.5px solid #35362C;
          border-radius: 20px;
          text-align: center;
          outline: none;
          text-decoration: none;" type="button" class="btn btn-info btn-lg" data-toggle="modal" data-target="#myModal">Info on Data</button>

        <!-- Modal -->
        <div class="modal fade" id="myModal" role="dialog">
          <div class="modal-dialog">

            <!-- Modal content-->
            <div class="modal-content">
              <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Information on the data used in the making of this map</h4>
              </div>
              <div class="modal-body">
                <p><h5><b>Health and Demographic Data</b></h5> The health and demographic data used in this map was provided by AIDSVu. <br> AIDSVu. Emory University, Rollins School of Public Health. Atlanta, GA. www.aidsvu.org.<br><br> Prevalence Data: Data represent persons living with HIV in New York City and not known to have died as of 12/31/2017 and who were reported to the NYC Department of Health and Mental Hygiene as of 09/30/2018. Cases are based on most recent known address and only residential ZIP Codes were included in the analysis. Cases with an unknown current ZIP Code or with a ZIP Code outside New York City were excluded. Data have not been adjusted for reporting delays <br><br>
                HIV surveillance data may be suppressed for two reasons. The negative values indicate the following:<br>
      -1: Data are not shown to protect privacy because a small number of cases and/or a small population size for reason listed below. <br>
      -3: Data are not available.<br><br>

      Data coded as -1 indicates suppression when the following suppression criteria is met:<br>
      1) Numerator (number of persons living with diagnosed HIV infection) is less than 5 and/or the denominator (number of people in that population group) is less than 500.<br><br> <h5><b>Condom Distribution Locations</b></h5> HIV condom distribution locations and information were provided by the NYC Department of Health and Mental Hygiene and accessed through NYCOpenData.<br><br> The NYC Condom Availability Program maintains a robust list of active venues where New York City (NYC) residents may access <b>free</b> safer sex products across all 5 boroughs of NYC.</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        </div>
        </div>

        </div>
        </div>
        <button style="font-family:'Quicksand', sans-serif; width: 200px;
          position:relative; left: 40%;
          padding: 10px;
          background-color: #FFF48F;
          color: #35362C;
          border: 1.5px solid #35362C;
          border-radius: 20px;
          text-align: center;
          outline: none;
          text-decoration: none;" type="button" class="btn btn-info btn-lg" data-toggle="modal" data-target="#myModal2">Navigating this map</button>

        <!-- Modal -->
        <div class="modal fade" id="myModal2" role="dialog">
          <div class="modal-dialog">

            <!-- Modal content-->
            <div class="modal-content">
              <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">How to Navigate this map</h4>
              </div>
              <div class="modal-body">
                <p>The purpose of this map is to provide a way for users to visualize the relationship between HIV prevelance in NYC, zipcode, and social determinants of health such as race and income. Additionally, locations that are a part of the NYC Condom Availability Program are marked. <br><br> Clicking on any marker will provide information about the associated condom distribution center. Clicking anywhere within the zipcode areas will provide a demographic breakdown of the associated zipcode. <br><br> Users can toggle between map layers using the drop-down at the top-right of the map. <br><br> This allows users to toggle between choropleth maps that visualize 1) Number of people in a zipcode living with HIV per 100,000 across all demographics; 2) Percent of zipcode population that is currently living in poverty.</p>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
              </div>
            </div>

          </div>
        </div>
      </div>
    </div>

<script defer>
  $(document).ready( function() { 

    var userCenter;
    var marker;

var Esri_WorldGrayCanvas = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer/tile/{z}/{y}/{x}', {
  attribution: 'Tiles &copy; Esri &mdash; Esri, DeLorme, NAVTEQ',
  maxZoom: 16});
  
    var map = L.map('map',{ center: [40.719504, -73.979370], zoom: 11,
        layers: [Esri_WorldGrayCanvas]
        })

    var layerControl = L.control.layers().addTo(map);

    


      function getColor(d) {
        return d > 1200 ? '#99000d' :
        d > 800 ? '#cb181d' :
        d > 600 ? '#ef3b2c' :
        d > 500 ? '#fb6a4a' :
        d > 350 ? '#fc9272' :
        d > 250 ? '#fcbba1' :
        d > 150 ? '#fee0d2' :
          '#fff5f0' ; 
      }

      function styleRT(feature) {
        return {
        fillColor: getColor(feature.properties.zipcoderate),
        weight: 2,
        opacity: 1,
        color: 'white',
        dashArray: '3',
        fillOpacity: 1
          };
      }


      function getColor1(d) {
        return d > 40 ? '#084594' :
        d > 30 ? '#2171b5' :
        d > 25 ? '#4292c6' :
        d > 20 ? '#6baed6' :
        d > 15 ? '#9ecae1' :
        d > 10 ? '#c6dbef' :
        d > 5 ? '#deebf7' :
          '#f7fbff' ; 
        }
    function stylePCT(feature) {
      return {
      fillColor: getColor1(feature.properties.PCTpov),
      weight: 2,
      opacity: 1,
      color: 'white',
      dashArray: '3',
      fillOpacity: 1
        };
      }

      var myStyle = {
        "opacity": 0
      };

        function styleOUT(feature) {
          return {
            fillColor: 'white',
          weight: 1,
          opacity: 0.5,
          color: 'white',
          dashArray: '3',
          fillOpacity: 0.2
            };
      }


    var nycrates;

      $.getJSON("nyc_zips.geojson", function(data){
        nycrates = L.geoJson(data,{
          onEachFeature: function (feature, layer){
            layer.bindPopup(feature.properties.description);
          }
        });



        $.getJSON("HIV.json", function(data){
          $.each(data, function(index,value) {
            zipcode = value["field3"];
            zipcoderate = value["field4"];
            zipcodecases = value["field6"];
            PCTpov = value["field39"];
            nycrates.eachLayer(function(layer) {
              if(layer.feature.properties.zcta == zipcode){
                layer.feature.properties.zipcoderate = zipcoderate;
                layer.feature.properties.zipcodecases = zipcodecases;
                layer.feature.properties.PCTpov = PCTpov;
                layer.setStyle(styleRT(layer.feature));
              }
            })
          })
        })
          layerControl.addOverlay(nycrates, "Rate of People Living with HIV per 100,000");
      })

    var nycpct;
      $.getJSON("nyc_zips.geojson", function(data){
        nycpct = L.geoJson(data,{
          onEachFeature: function (feature, layer){
            layer.bindPopup(feature.properties.description);
          }
        });


      $.getJSON("HIV.json", function(data){
        $.each(data, function(index,value) {
          zipcode = value["field3"];
          zipcoderate = value["field4"];
          zipcodecases = value["field6"];
          PCTpov = value["field39"];
          nycpct.eachLayer(function(layer) {
            if(layer.feature.properties.zcta == zipcode){
              layer.feature.properties.zipcoderate = zipcoderate;
              layer.feature.properties.zipcodecases = zipcodecases;
              layer.feature.properties.PCTpov = PCTpov;
              layer.setStyle(stylePCT(layer.feature));
            }
          })
        })
      })
            layerControl.addOverlay(nycpct, "Percent of Zipcode Population Living in Poverty");
      })

      



//Makers for where the condom distribution locaitons are
  var condoms;
    $.getJSON("condom.geojson", function(data){
      condoms=L.geoJson(data,{
        onEachFeature: function (feature, layer){
          layer.bindPopup('<h1>'+feature.properties.FacilityName+'</h1><p><b>Partner Type:</b> '+feature.properties.PartnerType+' <br> <b>Service Type:</b> Condoms and Lubricant <br> <b>Address:</b>'+feature.properties.Address+' <br> <b>Borough:</b>'+feature.properties.Borough+' <br> <b>Zipcode:</b>'+feature.properties.Zipcode+' <br> <b>Phone:</b>'+feature.properties.Phone+'<br> <b>Additional Info:</b>'+feature.properties.AdditionalInfo+' <br><b><h3>Hours:</h3></b><br> <center><b>Monday:</b>'+feature.properties.Monday+'<br><b>Tuesday:</b>'+feature.properties.Tuesday+'<br><b>Wednesday:</b>'+feature.properties.Wednesday+'<br><b>Thursday:</b>'+feature.properties.Thursday+'<br><b>Friday:</b>'+feature.properties.Friday+'<br><b>Saturday:</b>'+feature.properties.Saturday+'<br><b>Sunday:</b>'+feature.properties.Sunday+'</center>  </p>');
        }
      }).addTo(map);
    });

//  //L.control.layers(overlayMaps).addTo(map); 



  var ratesLegend = L.control({position: 'bottomright'});
  var percentLegend = L.control({position: 'bottomright'});

  ratesLegend.onAdd = function (map) {
  var div = L.DomUtil.create('div', 'info legend'),
  colors = [150, 250, 350, 500, 600, 800, 1200],
  labels = [],
  from, to;

    for (var i = 0; i < (colors.length-1); i++) {
  from = colors[i];
  to = colors[i + 1];
    div.innerHTML +=
      '<i style="background:' + getColor(colors[i] + 1) + '"></i>' +
      colors[i] + (colors[i + 1] ? '&ndash;' + colors[i + 1] + '<br>' : '+');

    }

  div.innerHTML += '<h4>Number of People Living with HIV per 100,00</h4>', labels.join('<br>');
    return div;
    };
    
   // ratesLegend.addTo(map);

    percentLegend.onAdd = function (map) {
    var div = L.DomUtil.create('div', 'info legend'),
    colors = [5, 10, 15, 20, 25, 30, 40],
    labels = [];

  for (var i = 0; i < colors.length; i++) {
    div.innerHTML +=
      '<i style="background:' + getColor1(colors[i] + 1) + '"></i>' +
      colors[i] + (colors[i + 1] ? '&ndash;' + colors[i + 1] + '<br>' : '+'); }

  div.innerHTML += '<h4>Percent of Zipcode Living in Poverty</h4>';
    return div;
    };

   // percentLegend.addTo(map);

var overlayMaps = {
    "Rate of People Living with HIV per 100,000": nycrates,
    "Percent of Zipcode Population Living in Poverty": nycpct,
    //"Condom Distribution Locations": condoms,
    //"Zipcode Stats": outline
  };

  var baseMaps = {
    "Esri_WorldGrayCanvas": Esri_WorldGrayCanvas,
    // "Percept of Population in Poverty": PCTpov
  };
var outline;
        $.getJSON("nyc_zips.geojson", function(data){style:myStyle;
          outline = L.geoJson(data,{
            onEachFeature: function (feature, layer){

              $.getJSON("HIV.json", function(data1){

          $.each(data1, function(index,value) {
            zipcode = value["field3"];
            zipcoderate = value["field4"];
            zipcodecases = value["field6"];
            PCTpov = value["field39"];
            blackrate = value["field13"];
            whiterate = value["field16"];
            hisprate = value["field19"];
            asianrate = value["field22"];
            medincome = value["field38"];
            hspct = value["field40"];
              if(feature.properties.zcta == zipcode){
                layer.setStyle(styleOUT(layer.feature));
                layer.bindPopup('<h1>'+zipcode+'</h1><p><b>HIV Cases:</b> '+zipcodecases+' <br><b>Black HIV Rate:</b> '+blackrate+' <br> <b>Hispanic HIV Rate:</b> '+hisprate+' <br> <b>White HIV Rate:</b>'+whiterate+' <br> <b>Asian HIV Rate:</b> '+asianrate+' <br><b>Median Household Income:</b> '+medincome+' </p>');
              }
          })
            })
            
            }
          }).addTo(map);
          
          })
          
          
          
          map.on("overlayadd", function (event) {
  outline.bringToFront();
});


ratesLegend.addTo(map);
currentLegend = ratesLegend;
    map.on('overlayadd', function (eventLayer) {
      if (eventLayer.name === 'Percent of Zipcode Population Living in Poverty') {
        this.removeControl(currentLegend);
        currentLegend = percentLegend;
        percentLegend.addTo(this); } 

      else if (eventLayer.name === 'Rate of People Living with HIV per 100,000') { 
        this.removeControl(currentLegend);
        currentLegend = ratesLegend;
        ratesLegend.addTo(this); }

      });

})


</script>
  <div id="map" style="margin-left: 100px; margin-bottom: 25px; margin-top:15px; width:90%; height:80%;">
    </div>



  </body> 

</html>
